<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Ce qui bat</title>

<style>
  body {
    margin: 0;
    background: url('background.jpg') center/cover no-repeat fixed;
    font-family: Calibri, Candara, Segoe, "Segoe UI", Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  /* ===== CERCLE ===== */
  #circle {
    width: 320px;
    height: 320px;
    border-radius: 50%;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(12px);
    border: 3px solid rgba(255,255,255,0.45);
    display: flex;
    justify-content: center;
    align-items: center;
    transform: scale(1);
    margin-top: -20px;
  }

  #circleContent {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    text-align: center;
    transform: scale(1);
  }

  #title {
    font-size: 26px;
    margin-bottom: 18px;
    font-weight: normal;
  }

  input[type="range"] {
    width: 220px;
  }

  #bpmLabel {
    margin-top: 8px;
    font-size: 14px;
    opacity: 0.85;
  }

  button {
    margin-top: 16px;
    padding: 10px 20px;
    background: #e63946;
    border: none;
    color: white;
    border-radius: 10px;
    cursor: pointer;
    font-size: 15px;
  }

  button:hover {
    background: #d62839;
  }

  /* ===== CARTEL (PORTRAIT, BAS DROITE) ===== */
  #cartel {
    position: fixed;
    bottom: 28px;
    right: 28px;
    width: 300px;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255,255,255,0.35);
    padding: 20px 22px;
    color: white;
    font-size: 14px;
    line-height: 1.6;
    text-align: left;
  }

  #cartel p {
    margin: 0 0 10px 0;
  }

  #cartel p:last-child {
    margin-bottom: 0;
  }
</style>
</head>

<body>

<!-- ===== CERCLE CENTRAL ===== -->
<div id="circle">
  <div id="circleContent">

    <div id="title">Ce qui bat</div>

    <input id="speedSlider" type="range" min="30" max="180" value="60" />
    <div id="bpmLabel">60 BPM (fréquence cardiaque)</div>

    <audio id="audio" src="coeur.mp3"></audio>
    <button id="playBtn">▶ Jouer le son</button>

  </div>
</div>

<!-- ===== CARTEL ===== -->
<div id="cartel">
  <p>Première recherche sonore autour du projet <em>Ce qui bat</em>.</p>

  <p>
    Proposition d’installation sculpturale et sonore en milieu forestier,
    créée dans le cadre de l’appel à candidature pour
    <em>Les Arpenteurs</em>.
  </p>

  <p>
    Festival porté par la communauté d’agglomération
    <em>Cœur de Flandre</em>.
  </p>
</div>

<script>
const audio = document.getElementById("audio");
const slider = document.getElementById("speedSlider");
const bpmLabel = document.getElementById("bpmLabel");
const playBtn = document.getElementById("playBtn");
const circle = document.getElementById("circle");
const content = document.getElementById("circleContent");

const BASE_BPM = 60;
let playing = false;

slider.addEventListener("input", () => {
  const bpm = Number(slider.value);
  bpmLabel.textContent = bpm + " BPM (fréquence cardiaque)";
  audio.playbackRate = bpm / BASE_BPM;
});

playBtn.addEventListener("click", () => {
  if (!playing) {
    audio.currentTime = 0;
    audio.play();
    playing = true;
    playBtn.textContent = "⏹ Arrêter le son";
    requestAnimationFrame(pulse);
  } else {
    audio.pause();
    playing = false;
    playBtn.textContent = "▶ Jouer le son";
    circle.style.transform = "scale(1)";
    content.style.transform = "scale(1)";
  }
});

function pulse() {
  if (!playing) return;

  const beatDuration = 1; // 60 BPM
  const phase = (audio.currentTime % beatDuration) / beatDuration;

  const bpm = Number(slider.value);
  const intensity = Math.min(1, Math.max(0.3, (bpm - 30) / 150));

  let pulseValue;
  if (phase < 0.15) {
    pulseValue = phase / 0.15;
  } else {
    pulseValue = Math.max(0, 1 - (phase - 0.15) / 0.85);
  }

  const scale = 1 + pulseValue * 0.14 * intensity;

  circle.style.transform = `scale(${scale})`;
  content.style.transform = `scale(${1 / scale})`;

  requestAnimationFrame(pulse);
}
</script>

</body>
</html>
